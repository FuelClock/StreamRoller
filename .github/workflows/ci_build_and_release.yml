# trigger on the cix.x.x tag.
name: CI process chain
run-name: ${{ github.actor }} running CI process on cix.x.x tag creation
on:
  workflow_dispatch:
  push:
    tags:
      - "ci*.*.*"
env:
#MY_API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
VERSION_TAG: ${{ github.GITHUB_REF_NAME }}
jobs:
  creating_readmes:
    runs-on: windows-latest
    steps:
      #- uses: actions/checkout@v4
      #- name: npm install
      #  run: npm install
      #- name: note time to check it was built later
      #  run: more .\extensions\users\README.md
      #- name: running node readmebuilder.mjs
      #  run: |
      #    cd docs/apidocs
      #    node readmebuilder.mjs
      #- name: check timestamp for update
      #  run: |
      #    dir
      #    more extensions\users\README.md
      #      - name: adding files to git
      #        run: |
      #          for /F "tokens=*" %a in (filelist.json) do git add %a
      #          git commit -m "autodoc readme update"
      #          git push
      - name: Increment Patch Version
        id: increment_version
        run: |
          $version = "${{ env.VERSION }}"
          $parts = $version -split "\."
          $major = $parts[0]
          $minor = $parts[1]
          $patch = [int]$parts[2] + 1
          $newVersion = "$major.$minor.$patch"
          echo "New version: $newVersion"
          echo "NEW_VERSION=$newVersion" >> $env:GITHUB_ENV
        shell: pwsh

      - name: Save New Version
        run: |
          echo "${{ env.NEW_VERSION }}"
        shell: pwsh
